<section class="section">
  <div class="container">
    <h1 class="title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <form action="/" method="get" class="box mb-6">
      <div class="columns is-multiline">
        <div class="column is-3">
          <label class="label">–õ–æ–≥–∏–Ω</label>
          <input class="input" type="text" name="login"  value="<%= filters.login || '' %>">
        </div>
        <div class="column is-3">
          <label class="label">–ò–º—è</label>
          <input class="input" type="text" name="f_name" value="<%= filters.f_name || '' %>">
        </div>
        <div class="column is-3">
          <label class="label">–§–∞–º–∏–ª–∏—è</label>
          <input class="input" type="text" name="s_name" value="<%= filters.s_name || '' %>">
        </div>
        <div class="column is-3">
          <label class="label">–û—Ç—á–µ—Å—Ç–≤–æ</label>
          <input class="input" type="text" name="t_name" value="<%= filters.t_name || '' %>">
        </div>
        <div class="column is-6">
          <label class="label" for="date_from">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç</label>
          <div class="control">
            <input class="input" type="date" name="date_from" id="date_from" value="<%= filters.date_from || '' %>">
          </div>
        </div>
      
        <div class="column is-6">
          <label class="label" for="date_to">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ</label>
          <div class="control">
            <input class="input" type="date" name="date_to" id="date_to" value="<%= filters.date_to || '' %>">
          </div>
        </div>
      </div>
      <div class="field is-grouped">
        <div class="control">
          <button class="button is-link">–ü–æ–∏—Å–∫</button>
        </div>
        <div class="control">
          <a href="/" class="button">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
      </div>
    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <% if (users.length) { %>
        <div class="mb-4">
          <a href="/add" class="button is-link">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
        </div>
      <table class="table is-fullwidth">
        <thead>
          <tr>
            <th>–õ–æ–≥–∏–Ω</th>
            <th>–ò–º—è</th>
            <th>–§–∞–º–∏–ª–∏—è</th>
            <th>–û—Ç—á–µ—Å—Ç–≤–æ</th>
            <th>–°–æ–∑–¥–∞–Ω</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(u => { %>
            <tr>
              <td><%= u.login %></td>
              <td><%= u.f_name %></td>
              <td><%= u.s_name %></td>
              <td><%= u.t_name || '-' %></td>
              <td><%= u.created_at.toLocaleDateString('ru-RU') %></td>
              <td>
                <a href="/edit/<%= u.login %>" class="button is-small is-info">‚úèÔ∏è</a>
                <a href="/attempts/<%= u.login %>" class="button is-small is-info">–ø–æ–ø—ã—Ç–∫–∏</a>
                <form
                  action="/delete/<%= u.login %>"
                  method="post"
                  style="display:inline;"
                  onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?');"
                  >
                  <button type="submit" class="button is-small is-danger">üóëÔ∏è</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
        <div class="mb-4">
          <a href="/add" class="button is-link">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
        </div>
      <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    <% } %>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <%
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏ query-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å —É—á—ë—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤, —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∞–∑–º–µ—Ä–∞
function buildQuery(pageNum) {
  const params = new URLSearchParams();
  params.set('page', pageNum);
  params.set('size', size);

  // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–ø—É—Å—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
  if (filters.login)     params.set('login', filters.login);
  if (filters.f_name)    params.set('f_name', filters.f_name);
  if (filters.s_name)    params.set('s_name', filters.s_name);
  if (filters.t_name)    params.set('t_name', filters.t_name);
  if (filters.date_from) params.set('date_from', filters.date_from);
  if (filters.date_to)   params.set('date_to', filters.date_to);

  return '?' + params.toString();
}
%>

<nav class="pagination" role="navigation" aria-label="pagination">
  <% if (page > 1) { %>
    <a class="pagination-previous" href="<%= buildQuery(page - 1) %>">–ü—Ä–µ–¥.</a>
  <% } else { %>
    <a class="pagination-previous" disabled>–ü—Ä–µ–¥.</a>
  <% } %>

  <!-- <ul class="pagination-list">
    <% 
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É ¬±2
      const start = Math.max(1, page - 2);
      const end   = page + 2;
      for (let i = start; i <= end; i++) { 
    %>
      <li>
        <a
          class="pagination-link <%= i === page ? 'is-current' : '' %>"
          href="<%= buildQuery(i) %>"
        ><%= i %></a>
      </li>
    <% } %>
  </ul> -->

  <a class="pagination-next" href="<%= buildQuery(page + 1) %>">–°–ª–µ–¥.</a>
</nav>

  </div>
</section>