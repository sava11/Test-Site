<section class="section">
  <div class="box">
    <div class="is-flex is-align-items-center is-justify-content-space-between mb-4">
      <h1 class="title m-0"><%= company.name %></h1>
      <% if (self_user && self_user.status > 1) { %>
        <div class="buttons are-small ml-3">
          <a class="button is-primary" href='/companies/edit/<%= company.id %>' title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">üìù</a>
          <button class="button is-danger" onclick="deleteCompany(<%= company.id %>)" title="–£–¥–∞–ª–∏—Ç—å">‚ùå</button>
        </div>
      <% } %>
    </div>    
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <%= company.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' %></p>
    <p><strong>–ê–¥—Ä–µ—Å:</strong> <%= company.address %></p>
    <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <%= company.phone || '–ù–µ —É–∫–∞–∑–∞–Ω' %></p>
    <p><strong>Email:</strong> <%= company.email || '–ù–µ —É–∫–∞–∑–∞–Ω' %></p>
    <% if (company.website) { %>
      <p><strong>–°–∞–π—Ç:</strong> <a href="<%= company.website %>" target="_blank"><%= company.website %></a></p>
    <% } %>
    <p><strong>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</strong> <%= company.experience_years %> –ª–µ—Ç</p>
    <p><strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong> <%= company.advantages || '–ù–µ —É–∫–∞–∑–∞–Ω—ã' %></p>
  </div>
  
  <!-- –£—Å–ª—É–≥–∏ –∫–æ–º–ø–∞–Ω–∏–∏ -->
  <div class="box">
    <h2 class="subtitle">–£—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã</h2>
    <% if (company.services && company.services.length > 0) { %>
      <table class="table is-fullwidth">
        <thead>
          <tr>
            <th>–£—Å–ª—É–≥–∞</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</th>
          </tr>
        </thead>
        <tbody>
          <% company.services.forEach(service => { %>
            <tr>
              <td><%= service.name %></td>
              <td><%= service.price %></td>
              <td><a href="/companies/<%= company.id %>/statistics/<%= service.id %>">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–µ–Ω üìä</a></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <p>–£—Å–ª—É–≥–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
    <% } %>
  </div>
  
  <!-- –§–∏–ª–∏–∞–ª—ã –∫–æ–º–ø–∞–Ω–∏–∏ -->
  <div class="box">
    <h2 class="subtitle">–§–∏–ª–∏–∞–ª—ã</h2>
    <% if (company.branches && company.branches.length > 0) { %>
      <ul>
        <% company.branches.forEach(branch => { %>
          <li><strong>–ê–¥—Ä–µ—Å:</strong> <%= branch.address %> 
            <% if (branch.phone) { %> <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <%= branch.phone %> <% } %>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      <p>–§–∏–ª–∏–∞–ª—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
    <% } %>
  </div>
</section>
<% if (self_user && self_user.status>1) { %>
<script>
  function deleteCompany(companyId){
    fetch('/companies/delete/'+companyId, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
      }
      return response.json();
    })
    .then(data => {
      // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω–Ω–æ–π/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
      window.location.href = "/companies";
    })
    .catch(error => {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏.');
    });
  }
</script>
<% } %>